<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gerador de Arte — Destaque + Manchete</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#0b0b0c; --panel:#121316; --ink:#eaeaea; --muted:#9aa3ad; --brand:#ffd400; }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0d0f13,#0b0b0c);color:var(--ink);font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    header{padding:20px 24px 8px;display:flex;align-items:center;gap:12px}
    header h1{font-size:18px;margin:0;font-weight:800;letter-spacing:.2px}
    .app{display:grid;grid-template-columns:380px 1fr;gap:18px;padding:0 24px 24px}
    @media (max-width: 980px){ .app{grid-template-columns:1fr} }
    .panel{background:var(--panel);border:1px solid #23262d;border-radius:16px;padding:16px 14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .panel h2{margin:4px 6px 12px;font-size:14px;color:var(--muted);font-weight:600;text-transform:uppercase;letter-spacing:.12em}
    label{display:block;font-size:12px;color:var(--muted);margin:10px 6px 6px}
    input[type="text"], textarea, select{width:100%;border:1px solid #2a2f39;background:#0e1116;color:var(--ink);border-radius:10px;padding:10px 12px;font-size:14px;outline:none}
    textarea{min-height:110px;resize:vertical}
    .row{display:flex;gap:10px;align-items:center}
    .row > *{flex:1}
    .btns{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
    button{background:#1f2937;color:#f7fbff;border:1px solid #2a2f39;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer}
    button.primary{background:var(--brand);color:#151515;border-color:#d6b700}
    button:disabled{opacity:.5;cursor:not-allowed}
    .stage{background:#0b0c0e;border:1px solid #23262d;border-radius:16px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:16px;gap:12px}
    .stage .canvas-wrap{position:relative;border-radius:12px;overflow:hidden;background:#111}
    .ghost{font-size:13px;color:#9199a6}
    .note{font-size:12px;color:#8892a0}
    .code{font-family:ui-monospace,Menlo,Consolas,monospace}
  </style>
</head>
<body>
  <header>
    <svg width="26" height="26" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="11" stroke="#ffd400" stroke-width="2"/><path d="M12 6.5V13M12 17.5h.01" stroke="#ffd400" stroke-width="2" stroke-linecap="round"/></svg>
    <h1>Gerador de Arte — Destaque + Manchete</h1>
  </header>

  <div class="app">
    <section class="panel">
      <h2>Conteúdo</h2>
      <label for="destaque">Destaque (ex.: ALERTA)</label>
      <input id="destaque" type="text" placeholder="ALERTA" value="ALERTA" />

      <label for="manchete">Manchete</label>
      <textarea id="manchete" placeholder="Digite a manchete..."></textarea>

      <div class="row">
        <div>
          <label for="upload">Foto de fundo</label>
          <input id="upload" type="file" accept="image/*" />
        </div>
        <div>
          <label for="overlay">Overlay (acima da foto)</label>
          <input id="overlay" type="file" accept="image/*" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="logo">Selo (opcional, canto superior direito)</label>
          <input id="logo" type="file" accept="image/*" />
        </div>
        <div>
          <label for="ratio">Proporção</label>
          <select id="ratio">
            <option value="1080x1350" selected>4:5 (1080×1350)</option>
            <option value="1080x1080">1:1 (1080×1080)</option>
            <option value="1080x1920">9:16 (1080×1920)</option>
          </select>
        </div>
      </div>

      <h2>Estilo</h2>
      <div class="row">
        <div>
          <label for="brand">Cor do Destaque</label>
          <input id="brand" type="color" value="#FFD400" />
        </div>
        <div>
          <label for="shade">Degradê inferior (0–100)</label>
          <input id="shade" type="range" min="0" max="100" step="1" value="85" />
        </div>
      </div>

      <div class="btns">
        <button id="render" class="primary">Gerar imagem</button>
        <button id="download" disabled>Baixar PNG</button>
        <button id="clear">Limpar</button>
      </div>
      <p class="note">Ordem das camadas: <b>Foto → Overlay → Textos/Selo</b>. Os textos sempre ficam por cima.</p>
    </section>

    <section class="stage">
      <div class="canvas-wrap">
        <canvas id="canvas" width="1080" height="1350"></canvas>
      </div>
      <div class="ghost">Pré-visualização do resultado (clique em “Gerar imagem”).</div>
    </section>
  </div>

  <script>
    const $ = (q) => document.querySelector(q);
    const canvas = $('#canvas');
    const ctx = canvas.getContext('2d');

    const els = {
      destaque: $('#destaque'),
      manchete: $('#manchete'),
      upload:   $('#upload'),
      overlay:  $('#overlay'),
      logo:     $('#logo'),
      ratio:    $('#ratio'),
      brand:    $('#brand'),
      shade:    $('#shade'),
      render:   $('#render'),
      download: $('#download'),
      clear:    $('#clear')
    };

    let bgURL = null, overlayURL = null, logoURL = null;

    function fileToURL(input, setter){
      input.addEventListener('change', () => {
        if(input.files && input.files[0]){
          const url = URL.createObjectURL(input.files[0]);
          setter(url);
        } else setter(null);
      });
    }

    fileToURL(els.upload,  (u)=>{bgURL=u});
    fileToURL(els.overlay, (u)=>{overlayURL=u});
    fileToURL(els.logo,    (u)=>{logoURL=u});

    function setCanvasSize(){
      const [w,h] = els.ratio.value.split('x').map(n=>parseInt(n,10));
      canvas.width = w; canvas.height = h;
    }

    function drawCover(img, x, y, w, h){
      const iw = img.width, ih = img.height;
      const ir = iw/ih, r = w/h;
      let dw, dh, dx, dy;
      if(ir > r){ dh = h; dw = dh*ir; dx = x + (w-dw)/2; dy = y; }
      else { dw = w; dh = dw/ir; dx = x; dy = y + (h-dh)/2; }
      ctx.drawImage(img, dx, dy, dw, dh);
    }

    function wrapText(text, maxWidth){
      const words = (text||"").split(/\s+/); let line = '', lines=[];
      for(const w of words){
        const test = line ? line + ' ' + w : w;
        const m = ctx.measureText(test).width;
        if(m > maxWidth && line){ lines.push(line); line = w; }
        else line = test;
      }
      if(line) lines.push(line);
      return lines;
    }

    async function loadImage(url){
      return new Promise((res, rej)=>{ if(!url) return res(null); const img=new Image(); img.onload=()=>res(img); img.onerror=rej; img.src=url; });
    }

    async function render(){
      setCanvasSize();
      const W = canvas.width, H = canvas.height;
      ctx.clearRect(0,0,W,H);

      // 1) Fundo
      if(bgURL){
        const bg = await loadImage(bgURL);
        if(bg) drawCover(bg,0,0,W,H);
      } else {
        ctx.fillStyle = '#333'; ctx.fillRect(0,0,W,H);
        ctx.fillStyle = '#777'; ctx.font = '600 28px Poppins'; ctx.fillText('Envie uma foto de fundo', 28, 48);
      }

      // 2) Overlay
      if(overlayURL){
        const ov = await loadImage(overlayURL);
        if(ov) ctx.drawImage(ov, 0, 0, W, H);
      }

      // 3) Textos (acima de tudo)
      const brand = els.brand.value || '#FFD400';
      const pad = Math.round(W*0.022);

      // Faixa do Destaque
      const badgeH = Math.round(H*0.055);
      const badgeText = (els.destaque.value||'').toUpperCase();
      ctx.font = `800 ${Math.round(badgeH*0.55)}px Poppins`;
      const badgeW = Math.min(W*0.52, Math.max(140, ctx.measureText(badgeText).width + pad*2));
      ctx.fillStyle = brand; ctx.fillRect(pad*1.2, H - (badgeH*3.2), badgeW, badgeH);
      ctx.fillStyle = '#111'; ctx.textBaseline='middle';
      ctx.fillText(badgeText, pad*1.6, H - (badgeH*2.675));

      // Painel escuro da manchete (degradê inferior)
      const shade = (+els.shade.value||85)/100;
      const g = ctx.createLinearGradient(0, H*0.65, 0, H);
      g.addColorStop(0, `rgba(0,0,0,${Math.max(0,shade-0.35)})`);
      g.addColorStop(1, `rgba(0,0,0,${shade})`);
      ctx.fillStyle = g; ctx.fillRect(0, H*0.60, W, H*0.40);

      // Manchete
      const headline = els.manchete.value || '';
      ctx.fillStyle = '#fff';
      const fontSize = Math.round(W*0.055);
      ctx.font = `800 ${fontSize}px Poppins`;
      const lines = wrapText(headline, W - pad*2);
      let y = H*0.64 + fontSize;
      for(const ln of lines.slice(0,6)){ ctx.fillText(ln, pad*1.2, y); y += fontSize*1.28; }

      // Logo (canto superior direito)
      if(logoURL){
        const lg = await loadImage(logoURL);
        if(lg){
          const size = Math.round(W*0.16);
          ctx.drawImage(lg, W - size - pad*1.2, pad*1.2, size, size);
        }
      }

      els.download.disabled = false;
    }

    els.render.addEventListener('click', render);

    els.download.addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'arte-manchete.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });

    els.clear.addEventListener('click', ()=>{
      els.destaque.value = 'ALERTA';
      els.manchete.value = '';
      els.upload.value = '';
      els.overlay.value = '';
      els.logo.value = '';
      els.brand.value = '#FFD400';
      els.shade.value = 85;
      bgURL = overlayURL = logoURL = null;
      setCanvasSize(); ctx.clearRect(0,0,canvas.width, canvas.height);
      els.download.disabled = true;
    });

    els.ratio.addEventListener('change', setCanvasSize);
    setCanvasSize();
  </script>
</body>
</html>
